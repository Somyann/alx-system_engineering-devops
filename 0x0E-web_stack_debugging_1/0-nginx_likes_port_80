#!/usr/bin/env bash
# Debugging Nginx port 80
# This script ensures Nginx is configured to listen on port 80 by replacing the default site configuration.

# Stop Apache if it's running to free up port 80
sudo service apache2 stop
sudo systemctl disable apache2

# Create a symbolic link from sites-available to sites-enabled
# -s: create symbolic link
# -f: force the link creation by removing any existing file at the target
sudo ln -sf /etc/nginx/sites-available/default /etc/nginx/sites-enabled/default

# Restart Nginx to apply the new configuration
sudo service nginx restart

# Check if Nginx is listening on port 80 and returning HTTP 200
if curl -o /dev/null -s -w "%{http_code}\n" http://localhost | grep -q '^200$'; then
  echo "2"
else
  echo "0"
fi
